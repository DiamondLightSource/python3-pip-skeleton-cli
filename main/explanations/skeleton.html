<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Working on the Skeleton Repo &mdash; python3-pip-skeleton 3.0.5.dev48+gf3c7e0f documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/dls-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="1. Record architecture decisions" href="decisions/0001-record-architecture-decisions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: rgb(7, 43, 93)" >
            <a href="../index.html" class="icon icon-home"> python3-pip-skeleton
            <img src="../_static/dls-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                main
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/new.html">Creating a new repo from the skeleton</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/existing.html">How to adopt the skeleton in an existing repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/update.html">How to update to the latest skeleton structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/excalidraw.html">How to embed Excalidraw diagrams</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/pypi.html">Creating a PyPI Token</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="why-use-skeleton.html">Why use a skeleton structure?</a></li>
<li class="toctree-l1"><a class="reference internal" href="why-src.html">Why use a source directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="why-pre-commit.html">Why use pre-commit</a></li>
<li class="toctree-l1"><a class="reference internal" href="decisions.html">Architectural Decision Records</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working on the Skeleton Repo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main">main</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dev-archive">dev-archive</a></li>
<li class="toctree-l2"><a class="reference internal" href="#process-for-making-a-change">Process for making a change</a></li>
<li class="toctree-l2"><a class="reference internal" href="#process-for-squashing-main">Process for squashing main</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/DiamondLightSource/python3-pip-skeleton/releases">Releases</a></li>
<li class="toctree-l1"><a class="reference external" href="genindex.html#http://">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: rgb(7, 43, 93)" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">python3-pip-skeleton</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Working on the Skeleton Repo</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/explanations/skeleton.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="working-on-the-skeleton-repo">
<span id="skeleton"></span><h1>Working on the Skeleton Repo<a class="headerlink" href="#working-on-the-skeleton-repo" title="Permalink to this heading"></a></h1>
<p>The <a class="reference external" href="https://github.com/DiamondLightSource/python3-pip-skeleton">python3-pip-skeleton</a> repo has a protected main branch and is restricted to
rebase PRs only.
It is also squashed occasionally so some careful procedures are required.</p>
<section id="main">
<h2>main<a class="headerlink" href="#main" title="Permalink to this heading"></a></h2>
<p>This branch is what all adopters of the skeleton project merge from so needs
to be kept tidy.
In particular it must not have any #nnn which would refer to the wrong commit
when merged into other repos (and github will see them and add incorrect
messages in PRs and Issues). This branch is protected from push and
restricted so that it can only be updated by a PR with REBASE.</p>
</section>
<section id="dev-archive">
<h2>dev-archive<a class="headerlink" href="#dev-archive" title="Permalink to this heading"></a></h2>
<p>This branch to tracks all commits, including those that are squashed out of
main. Force push is disallowed on this branch so that it can be kept as a
safe record of the history.</p>
</section>
<section id="process-for-making-a-change">
<h2>Process for making a change<a class="headerlink" href="#process-for-making-a-change" title="Permalink to this heading"></a></h2>
<p>To make changes. First take a new branch off of main, make your changes
and do a pull request to rebase main on the branch.</p>
<ul>
<li><p>get a branch on main</p>
<blockquote>
<div><ul class="simple">
<li><p>git checkout main</p></li>
<li><p>git reset –hard origin/main            # because main may have been rebased</p></li>
<li><p>git checkout -b feature</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Do the changes and test in CI with:</p>
<blockquote>
<div><ul class="simple">
<li><p>git add –all</p></li>
<li><p>git commit -m’my changes’</p></li>
<li><p>git push -u origin feature</p></li>
</ul>
</div></blockquote>
</li>
<li><p>When happy with changes use PR to rebase main on feature.</p></li>
<li><p>Next delete feature:</p>
<blockquote>
<div><ul class="simple">
<li><p>git push origin :feature</p></li>
<li><p>git checkout main</p></li>
<li><p>git branch -fd feature</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="process-for-squashing-main">
<h2>Process for squashing main<a class="headerlink" href="#process-for-squashing-main" title="Permalink to this heading"></a></h2>
<p>Once a year or so tidy up the history of main to make new adoptions easy.
Otherwise multiple changes to the same line in the history may cause multiple
merge conflicts on that line during re-merge of skeleton into projects
that have already adopted.</p>
<p>Perform these steps</p>
<ul>
<li><p>Get the dev-archive branch to remember your main commits</p>
<blockquote>
<div><ul class="simple">
<li><p>git checkout dev-archive</p></li>
<li><p>git merge main</p></li>
</ul>
</div></blockquote>
</li>
<li><p>If there are conflicts</p>
<blockquote>
<div><ul class="simple">
<li><p>git checkout –theirs</p></li>
<li><p>git add –all</p></li>
<li><p>git commit          # the commit message will be ‘merged …’ you can
add to it if needed</p></li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Now squash main right back to the original ededf000</dt><dd><ul class="simple">
<li><p>git checkout main</p></li>
<li><p>git reset –hard /origin/main</p></li>
<li><p>git rebase -i ededf000</p></li>
<li><p>In the rebase edit screen replace all <code class="docutils literal notranslate"><span class="pre">pick</span></code> with <code class="docutils literal notranslate"><span class="pre">s</span></code> except the first
one. save and quit</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Now create a handoff branch</dt><dd><ul class="simple">
<li><p>git checkout dev-archive</p></li>
<li><p>git checkout -b handoff/202x-xx-xx</p></li>
<li><p>git merge main</p></li>
<li><p>git push -u origin handoff/202x-xx-xx</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="decisions/0001-record-architecture-decisions.html" class="btn btn-neutral float-left" title="1. Record architecture decisions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   
  <div id="other-versions-div" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" style="visibility: hidden">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Other Versions</span>
      main
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="other-versions-dl"/>
    </div>
  </div>
  <script>
    function addVersion(name) {
      var dd = document.createElement("dd");
      var a = document.createElement("a");
      a.href = "../../" + name;
      a.innerText = name;
      dd.appendChild(a);
      document.getElementById('other-versions-dl').appendChild(dd);
    }
    // Get versions.txt and add a version for each line
    fetch("../../versions.txt").then(response => {
      if (response.ok) {
        document.getElementById('other-versions-div').style.visibility = "visible";
        return response.text().then(text => text.split(/\r?\n/).forEach(addVersion))
      }
    });
  </script>


</body>
</html>